- id: '1515525794372'
  alias: Felix rum, tänd
  trigger:
  - platform: time
    at: 07:00:00
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 5
  - platform: time
    at: 09:30:00
  - platform: state
    entity_id:
    - group.my_people
    to: home
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: template
        value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
        after: 07:00:00
    - condition: and
      conditions:
      - condition: template
        value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
      - condition: time
        weekday:
        - sat
        - sun
        after: 09:30:00
  - condition: state
    entity_id: group.my_people
    state: home
  action:
  - service: script.turn_on_felix_rum
    data: {}
- id: '180109204500'
  alias: Felix rum, släck
  trigger:
  - platform: time
    at: '23:00:00'
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    above: 5
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - sun
    enabled: false
  action:
  - service: script.turn_off_felix_rum
    data: {}
  mode: single
- id: '180109204000'
  alias: Felix rum helg, tänd
  trigger:
  - platform: time
    at: 09:30:00
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: '5'
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
    - condition: time
      weekday:
      - sat
      - sun
  - condition: state
    entity_id: group.my_people
    state: home
  action:
  - service: script.turn_on_felix_rum
- id: '1515522028713'
  alias: Felix rum lov, tänd
  trigger:
  - platform: time
    at: '10:00'
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: '5'
  condition:
  - condition: template
    value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
  action:
  - service: script.turn_on_felix_rum
- id: '180109203600'
  alias: Felix rum lov, släck
  trigger:
  - platform: time
    at: '23:00'
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    above: '5'
  action:
  - service: script.turn_off_felix_rum
- id: '1515530983851'
  alias: Allmän belysning, tänd
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 5
  - platform: state
    entity_id: group.my_people
    from: not_home
    to: home
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
    - condition: time
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  - condition: state
    entity_id: group.my_people
    state: home
    enabled: true
  action:
  - service: script.turn_on_general_lights
    data: {}
- id: 9f920a28dc6b4985b53ecb6e13c42a06
  alias: Morgonbelysning, tänd
  trigger:
  - platform: time
    at: 06:55
  condition:
  - condition: and
    conditions:
    - condition: numeric_state
      entity_id: sun.sun
      below: 5
      attribute: elevation
    - condition: time
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    - condition: numeric_state
      entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
      below: 250
  - condition: state
    entity_id: group.my_people
    state: home
  action:
  - service: script.turn_on_morning_lights
    data: {}
- id: 0b1073dedfa245b2835600cf6972b74a
  alias: Morgonbelysning, tänd, helg
  trigger:
  - platform: time
    at: 08:30
  condition:
  - condition: and
    conditions:
    - condition: numeric_state
      entity_id: sun.sun
      below: 5
      attribute: elevation
    - condition: time
      weekday:
      - sat
      - sun
    - condition: numeric_state
      entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
      below: 250
  - condition: state
    entity_id: group.my_people
    state: home
  action:
  - service: script.turn_on_morning_lights
    data: {}
- id: '1515530983853'
  alias: Allmän belysning, tänd, helg
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 5
  - platform: state
    entity_id: group.my_people
    from: not_home
    to: home
    for:
      hours: 0
      minutes: 1
      seconds: 0
  condition:
  - condition: and
    conditions:
    - condition: template
      value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
    - condition: time
      weekday:
      - sat
      - sun
  - condition: state
    entity_id: group.my_people
    state: home
    enabled: true
  action:
  - service: script.turn_on_general_lights
    data: {}
- id: '1515530983852'
  alias: Allmän belysning, släck
  trigger:
  - platform: time
    at: '23:45:00'
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    above: '5'
  - platform: state
    entity_id: group.my_people
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: sun.sun
        above: 5
        attribute: elevation
        alias: Sun above 5°
      - condition: numeric_state
        entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
        above: 250
        alias: Bright
      alias: Is Bright and Sun > 5°
    - condition: sun
      after: sunset
    - condition: state
      entity_id: group.my_people
      state: not_home
    alias: Bright day, after sunset or nobody home
  action:
  - service: script.turn_off_general_lights
    data: {}
  mode: single
- id: '180109222801'
  alias: Utomhusbelysning, tänd på morgonen
  trigger:
  - at: 07:00:00
    platform: time
  condition:
  - condition: sun
    before: sunrise
  action:
  - service: script.turn_on_outdoor
- id: '200305204500'
  alias: Utomhusbelysning, tänd på kvällen
  trigger:
  - event: sunset
    platform: sun
  action:
  - service: script.turn_on_outdoor
- id: '180109222803'
  alias: Utomhusbelysning, släck
  trigger:
  - platform: sun
    event: sunrise
  - platform: time
    at: '23:55:00'
  action:
  - service: script.turn_off_outdoor
- id: '180109231900'
  alias: Telefonladdare på
  trigger:
  - platform: time
    at: '23:00:00'
  - platform: numeric_state
    entity_id: sensor.op9_pro_battery_level
    below: 25
  - platform: time
    at: 06:30
  condition:
  - condition: state
    entity_id: person.rickard_nord
    state: home
  - condition: numeric_state
    entity_id: sensor.op9_pro_battery_level
    below: '99'
  action:
  - data: {}
    entity_id: switch.nexa_5
    service: switch.turn_on
  mode: single
- id: '180109231901'
  alias: Telefonladdare av
  trigger:
  - platform: time
    at: 00:00:00
  - platform: time
    at: 07:00:00
  action:
    service: homeassistant.turn_off
    data:
      entity_id: switch.nexa_5
- id: '190806164100'
  alias: Mulet (tänd)
  trigger:
  - platform: numeric_state
    entity_id: sensor.yr_cloudiness
    above: 80
    for: 00:10:00
    enabled: false
  - platform: state
    entity_id: group.my_people
    to: home
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - platform: state
    entity_id:
    - sensor.template_yrwthr
    to: 'True'
    enabled: false
  - platform: numeric_state
    entity_id: sensor.template_fronius_solar_power
    below: '0.4'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    enabled: false
  - platform: numeric_state
    entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
    for:
      hours: 0
      minutes: 2
      seconds: 0
    below: 250
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    above: 5
    attribute: elevation
  - condition: state
    entity_id: group.my_people
    state: home
  - condition: numeric_state
    entity_id: sensor.template_fronius_solar_power
    below: 0.4
    enabled: false
  - condition: state
    entity_id: sensor.template_yrwthr
    state: 'True'
    enabled: false
  - condition: numeric_state
    entity_id: sensor.yr_cloudiness
    above: '79'
    enabled: false
  - condition: numeric_state
    entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
    below: 250
  action:
  - service: script.turn_on_general_lights
    data: {}
  mode: single
- id: '1603878294613'
  alias: Mulet (släck)
  description: Släck lamporna när det inte är mulet längre
  trigger:
  - platform: state
    entity_id: group.my_people
    from: home
    to: not_home
    for: 00:05:00
  - platform: numeric_state
    entity_id: sensor.yr_cloudiness
    below: 80
    for: 00:10:00
    enabled: false
  - platform: state
    entity_id:
    - sensor.template_yrwthr
    to: 'False'
    enabled: false
  - platform: numeric_state
    entity_id: sensor.template_fronius_solar_power
    above: '0.5'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    enabled: false
  - platform: numeric_state
    entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
    for:
      hours: 0
      minutes: 5
      seconds: 0
    above: 400
  condition:
  - condition: numeric_state
    entity_id: sun.sun
    above: 5
    attribute: elevation
  action:
  - data: {}
    service: script.turn_off_general_lights
  mode: single
- id: '1603895419161'
  alias: Sluta ladda Rickards telefon
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.op9_pro_battery_level
    above: '99'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  condition:
  - condition: state
    entity_id: person.rickard_nord
    state: home
  action:
  - service: switch.turn_off
    entity_id: switch.nexa_5
  mode: single
- id: '1610304172777'
  alias: Ladda bilen, SoC <20%
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.azarel_charger
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: sensor.azarel_battery
    below: '20'
  - condition: state
    entity_id: device_tracker.azarel_location_tracker
    state: home
  - condition: numeric_state
    entity_id: sensor.framsidan_temperature
    below: 5
  action:
  - service: automation.turn_on
    entity_id: automation.laddat_till_20
  - service: script.charge_the_tesla
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1610304940192'
  alias: Ladda bilen, stoppa, SoC ≥20%
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.azarel_battery
    above: '20'
    below: '23'
  condition:
  - condition: state
    entity_id: binary_sensor.azarel_charger
    attribute: charging_state
    state: Charging
  - condition: state
    entity_id: device_tracker.azarel_location_tracker
    state: home
  action:
  - if:
    - condition: state
      entity_id: binary_sensor.low_price
      state: 'off'
    then:
    - service: script.ladda_tesla_stoppa
      data: {}
    else:
    - service: notify.mobile_app_op9_pro
      data:
        message: Azarel har nått SoC {{ states("sensor.azarel_battery") }}%
        title: Azarel laddar fortfarande pga. lågt elpris.
  - service: automation.turn_off
    entity_id: automation.laddat_till_20
  mode: single
- id: '1617052336219'
  alias: Dags att ladda plattan
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.sm_p610_batteriniva
    below: 15
  condition:
  - condition: device
    type: is_not_plugged_in
    device_id: 12560843ff3ebcb9b53643f71e1c6efc
    entity_id: binary_sensor.sm_p610_laddar
    domain: binary_sensor
  action:
  - service: notify.rickards_devices
    data:
      message: Samsung-plattan har mindre än 25% laddning.
      title: Dags att ladda plattan
  mode: single
- id: '1633032752936'
  alias: Tänd tidig morgon
  description: ''
  trigger:
  - platform: time
    at: 05:30
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: sun
    before: sunrise
  action:
  - service: script.early_morning_lights_on
    data: {}
  mode: single
- id: '1643056235541'
  alias: 'Ladda Azarel: lågt elpris'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.low_price_off_peak
    to: 'on'
    enabled: false
  - platform: state
    entity_id:
    - binary_sensor.azarel_charger
    to: 'on'
  - platform: time_pattern
    hours: /1
    alias: Every hour
  condition:
  - condition: state
    entity_id: device_tracker.azarel_location_tracker
    state: home
  - condition: state
    entity_id: binary_sensor.azarel_charger
    state: 'on'
  - condition: state
    entity_id: binary_sensor.low_price_off_peak
    state: 'on'
    enabled: false
  - condition: template
    value_template: '{{ now() >= as_datetime(states("sensor.template_next_charge"))
      }}'
    alias: Passed Start time
  action:
  - service: script.charge_the_tesla
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1643296123979'
  alias: Ladda bilen, stoppa
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.low_price
    to: 'off'
  condition:
  - condition: state
    entity_id: device_tracker.azarel_location_tracker
    state: home
  - condition: numeric_state
    entity_id: sensor.azarel_battery
    above: '20'
  - condition: state
    entity_id: binary_sensor.low_price
    state: 'off'
  - condition: state
    entity_id: binary_sensor.azarel_charging
    state: 'on'
  - condition: state
    entity_id: automation.ladda_bilen_nar_det_ar_billigt
    state: 'on'
    alias: Confirm automation Ladda vid lågt pris is on
  action:
  - service: script.ladda_tesla_stoppa
    data: {}
  mode: single
- id: '1647968733347'
  alias: Ladda Zoe:n
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.zoe_plugged_in
    from: 'off'
    to: 'on'
  - platform: time_pattern
    hours: /1
    alias: Every hour
  - platform: state
    entity_id:
    - binary_sensor.zoe_plug
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: sensor.zoe_battery_level
    below: 90
  - condition: template
    value_template: '{{ now() >= as_datetime(states("sensor.template_next_charge"))
      }}'
    alias: Passed Start time
  - condition: or
    conditions:
    - condition: state
      entity_id: binary_sensor.zoe_plug
      state: unavailable
    - condition: state
      entity_id: binary_sensor.zoe_plug
      state: 'on'
    alias: Zoe Plug inkopplad or otillgänglig
    enabled: false
  - condition: state
    entity_id: binary_sensor.zoe_charging
    state: 'off'
  action:
  - service: script.ladda_zoe
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1652813052285'
  alias: Wall-E, fellarm
  description: ''
  trigger:
  - platform: state
    entity_id:
    - vacuum.wall_e
    to: error
  - platform: state
    entity_id:
    - vacuum.wall_e
    for:
      hours: 0
      minutes: 30
      seconds: 0
    to: returning
  condition:
  - condition: template
    value_template: '{{ state_attr("vacuum.wall_e", "error").description != ''rain
      delay'' }}'
    alias: Error NOT 'rain delay'
  action:
  - service: notify.mobile_app_op9_pro
    data:
      message: Fel på gräsklipparen ({{ state_attr("vacuum.wall_e", "error").description
        }}). Batteri {{ state_attr("vacuum.wall_e", "battery_level") }}%.
      title: Wall-E larm
  mode: single
- id: '1656709628350'
  alias: Ladda Zoe:n, klocka
  description: ''
  trigger:
  - platform: time
    at: input_datetime.zoe_hour
  condition: []
  action:
  - service: script.ladda_zoe
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1657529930391'
  alias: Morgondagens priser
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.template_nordpool_tomorrow_valid
    to: 'on'
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      message: "Nu är morgondagens priser uppdaterade.\\n avg: {{states(\"sensor.template_nordpool_tomorrow_avg\")}}
        kr\\n min: {{states(\"sensor.template_nordpool_tomorrow_min\")}} kr\\n max:
        {{states(\"sensor.template_nordpool_tomorrow_max\")}} kr\\n{% for price in
        state_attr('sensor.nordpool_kwh_se3_sek_3_095_0', 'tomorrow') -%}\n  {{ '{:02d}:
        {:.1f}'.format((loop.index-1), price|float(0) * 125) -}}\n  {{ \", \" if not
        loop.last else \"\" -}}\n{% endfor %}"
      title: Elpriset uppdaterat
  mode: single
- id: '1659106208657'
  alias: Wall-E, dags att byta blad
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.template_walle_blade_hours
    above: 60
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      title: Dags att byta knivar på Wall-E
      message: Bladen har använts i {{ (state_attr("vacuum.wall_e","blades").current_on
        | int / 60) | round(0) }} timmar.
  mode: single
- id: '1661109418803'
  alias: 'Ladda Azarel: på klocka'
  description: ''
  trigger:
  - platform: time
    at: input_datetime.azarel_hour
  condition:
  - condition: state
    entity_id: device_tracker.azarel_location_tracker
    state: home
  - condition: state
    entity_id: binary_sensor.azarel_charger
    state: 'on'
  - condition: state
    entity_id: binary_sensor.low_price
    state: 'on'
    enabled: false
  action:
  - service: script.charge_the_tesla
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1662395114345'
  alias: Värmepumpen, tillåt elpatron
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.low_price
    alias: When Cheap
    to: 'on'
  - platform: numeric_state
    entity_id: sensor.hem_gen5_electric_consumed_2
    below: 16
  condition:
  - condition: state
    entity_id: binary_sensor.low_price
    state: 'on'
  action:
  - service: switch.turn_off
    data: {}
    target:
      entity_id:
      - switch.varmepumpen_b
      - switch.varmepumpen_a
  mode: single
- id: '1662395326862'
  alias: Värmepumpen, blockera elpatron
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.low_price
    alias: When expensive
    to: 'off'
  - platform: numeric_state
    entity_id: sensor.hem_gen5_electric_consumed_2
    above: 20
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.varmepumpen_b
  - if:
    - condition: state
      entity_id: binary_sensor.low_price
      state: 'off'
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.varmepumpen_a
    alias: If expensive block completely
  - delay:
      hours: 0
      minutes: 0
      seconds: 6
      milliseconds: 0
  - if:
    - condition: numeric_state
      entity_id: sensor.hem_gen5_electric_consumed_2
      above: 21
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.varmepumpen_a
  mode: single
- id: '1662572482443'
  alias: Diskmaskinen, starta på klocka
  description: ''
  trigger:
  - platform: time
    at: input_datetime.diskmaskinen_timme
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.clever_spz3
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: automation.turn_off
    data: {}
    target:
      entity_id: automation.diskmaskinen_starta_pa_klocka
  mode: single
- id: '1662626703155'
  alias: Ladda Zoe, stoppa
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.zoe_battery_level'')|int >= states(''input_number.zoe_soc_upper_limit'')|int
      }}'
    enabled: false
  - platform: numeric_state
    entity_id: sensor.zoe_battery_level
    above: input_number.zoe_soc_upper_limit
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.zoe_upper_limit
      state: 'on'
    - condition: state
      state: charge_in_progress
      entity_id: sensor.zoe_charge_state
    - condition: numeric_state
      entity_id: sensor.zoe_battery_level
      above: input_number.zoe_soc_upper_limit
  action:
  - service: script.1662626875831
    data: {}
  mode: single
- id: '1663015641931'
  alias: Tvättmaskinen, starta på klockslag
  description: ''
  trigger:
  - platform: time
    at: input_datetime.tvattmaskinen_timme
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.clever_spz2
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id: automation.tvattmaskinen_starta_pa_klockslag
  mode: single
- id: '1663084425465'
  alias: 'Tvättmaskinen klar '
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.clever_spz2_electric_consumption_w_2
    above: 1000
  condition: []
  action:
  - wait_for_trigger:
    - platform: numeric_state
      entity_id: sensor.clever_spz2_electric_consumption_w_2
      for:
        hours: 0
        minutes: 2
        seconds: 0
      below: 5
  - service: notify.fridas_devices
    data:
      title: Tvättmaskinen är klar
      message: Tvättmaskinen blev färdig kl. {{ now().strftime('%H:%M den %d/%m')
        }}
  - service: notify.rickards_devices
    data:
      title: Tvättmaskinen är klar
      message: Tvättmaskinen blev färdig kl. {{ now().strftime('%H:%M den %d/%m')
        }}
  mode: single
- id: '1663103501093'
  alias: Spelrummet, on-off
  description: ''
  trigger:
  - device_id: c53b352f8a5c574b8c18e8cc9b371448
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
  condition: []
  action:
  - type: toggle
    device_id: d28a6511fb054b24bae3ad0163a59379
    entity_id: light.spelrummet_taket_light
    domain: light
  mode: single
- id: '1663105406145'
  alias: Spelrummet, LED
  description: ''
  use_blueprint:
    path: niro1987/zha_ikea_tradfri_5button_remote_preset.yaml
    input:
      remote: c53b352f8a5c574b8c18e8cc9b371448
      light: light.spelrummet_taket_light
      preset: input_select.helper_spelrummet_led
- id: '1663141580671'
  alias: ALARM, ChargeNode offline
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.chargenode_pie
    to: 'off'
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      title: Laddaren offline!
      message: Det går inte att nå ChargeNode-laddaren!
      data:
        push:
          sound:
            name: default
            critical: 1
            volume: 1
        channel: Alarm
        ttl: 0
        priority: high
  mode: single
- id: '1663512131780'
  alias: Spabadet, slå på värmen
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.l2_overcurrent
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    enabled: true
    alias: When low load L2 for 60 sec
  - platform: numeric_state
    entity_id: sensor.hem_gen5_electric_consumed_2
    for:
      hours: 0
      minutes: 1
      seconds: 0
    below: 9
    enabled: true
    alias: When total load L2 <9A for 60 sec
  condition:
  - condition: numeric_state
    entity_id: sensor.hem_gen5_electric_consumed_2
    below: 9
    enabled: true
    alias: If total load L2 <9A
  - condition: state
    entity_id: sensor.nordpool_kwh_se3_sek_3_095_0
    attribute: low_price
    state: true
    alias: If low price
  - condition: or
    conditions:
    - condition: state
      entity_id: script.spabadet_pump_and_heater
      state: 'on'
      alias: If spabadet should be running
    - condition: state
      entity_id: script.spabadet_pause_control
      state: 'on'
      alias: If manual control of spabadet
    alias: If spabadet should be running
  - condition: state
    entity_id: input_boolean.overcurrent_l2
    state: 'on'
    alias: If heater stopped because high load
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.spabadet_l2
      - switch.spabadet_l3
    alias: Turn on pumps and heater
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.overcurrent_l2
    alias: Turn off high load flag
  mode: single
- id: '1663512583705'
  alias: Spabadet, stäng av värmaren
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.nordpool_kwh_se3_sek_3_095_0
    attribute: low_price
    to: false
    alias: When expensive
  - platform: state
    entity_id:
    - binary_sensor.l2_overcurrent
    to: 'on'
    id: overcurrent_l2
    alias: When high load L2
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: script.spabadet_pump_and_heater
      state: 'on'
    - condition: state
      entity_id: script.spabadet_pause_control
      state: 'off'
    alias: If any Spabadet script are running
  action:
  - service: switch.turn_off
    data: {}
    target:
      entity_id: switch.spabadet_l2
    alias: Turn off heater
  - choose:
    - conditions:
      - condition: trigger
        id: overcurrent_l2
      sequence:
      - service: input_boolean.turn_on
        data: {}
        target:
          entity_id: input_boolean.overcurrent_l2
    alias: If high load set overcurrent-flag
  mode: single
- id: '1663922858212'
  alias: Spabadet, run pumps and heater
  description: ''
  trigger:
  - platform: time_pattern
    hours: /4
    minutes: '0'
    seconds: '0'
    alias: Every four hours
  condition: []
  action:
  - service: script.turn_on
    data: {}
    target:
      entity_id: script.spabadet_pump_and_heater
  mode: single
- id: '1664118673084'
  alias: Tvättstugan, LED
  description: ''
  use_blueprint:
    path: niro1987/zha_ikea_tradfri_5button_remote_preset.yaml
    input:
      remote: 6a70347d6c5f0791963cff2b5e01c92b
      light: light.tvattstugan_banken_light
      preset: input_select.helper_spelrummet_led
- id: '1664611841028'
  alias: Check Cleverio status
  description: ''
  trigger:
  - platform: time_pattern
    hours: /1
  condition: []
  action:
  - service: zwave_js.ping
    data: {}
    target:
      entity_id:
      - switch.cleverio_zw_plug_1
      - switch.clever_spz2
      - switch.clever_spz3
    enabled: false
  - service: button.press
    data: {}
    target:
      entity_id:
      - button.node_15_ping
      - button.node_17_ping
      - button.node_18_ping
  mode: single
- id: '1664994425706'
  alias: iGrill alarm
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.igrill_probe_1'')|int >= states(''input_number.igrill_target_temp'')|int
      }}'
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      title: iGrill alarm
      message: Temperaturen är {{ states.sensor.igrill_probe_1.state|int }}°C.
  mode: single
- id: '1671363832692'
  alias: 'ALARM: Enheter offline'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.node_18_node_status
    - sensor.node_17_node_status
    from: alive
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      message: Tvätt- eller diskmaskinen är offline.
      title: Enheter är offline
  mode: single
- id: '1672646126224'
  alias: 'Förrådet: slå på värmen'
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.199_temperature
    below: 10
    alias: When Förrådet temp <10
  - platform: state
    entity_id:
    - binary_sensor.low_price_off_peak
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.low_price_off_peak
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.199_temperature
    below: 10
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: switch.popp_outdoor
  mode: single
- id: '1672652238394'
  alias: 'Förrådet: stäng av'
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.199_temperature
    alias: When Förrådet temp >11
    above: 11
  - platform: state
    entity_id:
    - binary_sensor.low_price
    to: 'off'
  condition: []
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: switch.popp_outdoor
  mode: single
- id: '1673507757148'
  alias: Belysning, arbetsdagar, slå på
  description: ''
  trigger:
  - platform: time
    at: 08:00:00
  condition:
  - condition: time
    weekday:
    - thu
    - fri
    - mon
    alias: On Mon, Thu, Fri
  - condition: template
    value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
    alias: Before Sunrise
  - condition: state
    entity_id: person.rickard_nord
    state: home
    for:
      hours: 0
      minutes: 5
      seconds: 0
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: group.kontoret
    alias: Turn on Kontoret
  mode: single
- id: '1675949713517'
  alias: Spabadet, pump and heater
  description: ''
  trigger:
  - platform: time_pattern
    hours: /1
    alias: Every hour
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: script.turn_on
    data: {}
    target:
      entity_id: script.spabadet_pump_and_heater_v2
    alias: Run Spabadet, pump and heater (V2)
  mode: single
- id: '1677244066232'
  alias: Spabadet, larm om värmen
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.spabadet_l3_power
    for:
      hours: 0
      minutes: 5
      seconds: 0
    above: 0.5
  condition:
  - condition: numeric_state
    entity_id: sensor.spabadet_l2_power
    below: 1
  - condition: state
    entity_id: switch.spabadet_l2
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.template_spabadet_temperature
    below: 34
  - condition: numeric_state
    entity_id: sensor.template_spabadet_l3_current_a
    above: 0.5
  action:
  - service: notify.rickards_devices
    data:
      message: Värmen är på men drar ingen ström.
      title: Spabadet
  mode: single
- id: '1684931331914'
  alias: 'Wall-E: Query Status'
  description: Tvinga uppdatering av Wall-E
  trigger:
  - platform: time_pattern
    hours: /1
  condition:
  - condition: time
    after: '10:00:00'
    before: '18:00:00'
    alias: Between 10 and 18
  - condition: template
    value_template: '{{ (as_timestamp(now()) - as_timestamp(state_attr(''vacuum.wall_e'',''state_updated_at'')))
      > 3600 }}'
    alias: Updated at least an hour ago
  action:
  - service: landroid_cloud.partymode
    data:
      party_mode_enabled: false
    target:
      device_id: 04744719de96abcefa75f8ffeeb42a05
    alias: Disable Wall-E Party Mode
  mode: single
- id: '1685565293861'
  alias: Ladda Zoe, inkopplad
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.zoe_plug
    to: 'on'
  condition: []
  action:
  - service: automation.turn_on
    data: {}
    target:
      entity_id: automation.ladda_fridas_bil
  mode: single
- id: '1685708337936'
  alias: Spabadet, still running manually notification
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.spabadet_manual
    to: 'on'
    for:
      hours: 4
      minutes: 0
      seconds: 0
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      message: Spabadet kör fortfarande manuellt.
  - delay:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  - if:
    - condition: state
      entity_id: input_boolean.spabadet_manual
      state: 'on'
    then:
    - service: notify.rickards_devices
      data:
        message: Spabadet kör fortfarande manuellt efter 6 timmar…
  mode: single
- id: '1685775877485'
  alias: Ladda Zoe, stäng av automation
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.zoe_charging
    to: 'on'
  condition: []
  action:
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id: automation.ladda_fridas_bil
  mode: single
- id: '1686552991281'
  alias: Wall-E, notify starts cutting
  description: ''
  trigger:
  - platform: state
    entity_id:
    - vacuum.wall_e
    to: mowing
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      message: Wall-E börjar klippa!
  mode: single
