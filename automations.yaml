- id: '1515522028713'
  alias: Belysning tänd, Felix rum
  description: ''
  trigger:
  - platform: time
    at: '10:00'
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: '5'
  condition:
  - condition: template
    value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
  action:
  - service: script.turn_on_felix_rum
    data: {}
- id: '180109203600'
  alias: Belysning släck, Felix rum
  description: ''
  trigger:
  - platform: time
    at: '23:00'
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    above: '5'
  action:
  - service: script.turn_off_felix_rum
    data: {}
- id: '1515530983851'
  alias: Belysning tänd, Allmän
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    below: 5
    alias: When Sun below 5°
  - platform: state
    entity_id:
    - group.my_people
    from: not_home
    to: home
    for:
      hours: 0
      minutes: 0
      seconds: 0
    alias: When Familjen comes home
  - platform: numeric_state
    entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
    for:
      hours: 0
      minutes: 2
      seconds: 0
    below: 300
    alias: When Murky for 2 mins
  condition:
  - condition: or
    conditions:
    - condition: numeric_state
      entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
      below: 300
    - condition: numeric_state
      entity_id: sun.sun
      below: 5
      attribute: elevation
    alias: If Sun below 5° OR Luminance < 300
  - condition: state
    entity_id: group.my_people
    state: home
    enabled: true
  action:
  - service: script.turn_on_general_lights
    data: {}
- id: 9f920a28dc6b4985b53ecb6e13c42a06
  alias: Belysning tänd, Morgon
  description: ''
  trigger:
  - platform: time
    at: 06:55
    id: weekday
  - platform: time
    at: 08:30:00
    id: weekend
  condition:
  - condition: and
    conditions:
    - condition: numeric_state
      entity_id: sun.sun
      below: 5
      attribute: elevation
    - condition: numeric_state
      entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
      below: 250
  - condition: state
    entity_id: group.my_people
    state: home
  action:
  - if:
    - condition: trigger
      id:
      - weekday
    - condition: time
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    then:
    - service: script.turn_on_morning_lights
      data: {}
    alias: When triggered by weekday on a weekday
  - if:
    - condition: trigger
      id:
      - weekend
    - condition: time
      weekday:
      - sat
      - sun
    then:
    - service: script.turn_on_morning_lights
      data: {}
    alias: When triggered by weekend on the weekend
- id: '1515530983852'
  alias: Belysning släck, Allmän
  description: ''
  trigger:
  - platform: time
    at: '23:45:00'
    alias: At 23:45
  - platform: numeric_state
    entity_id: sun.sun
    value_template: '{{ state.attributes.elevation }}'
    above: '5'
    alias: When Sun above 5°
  - platform: state
    entity_id: group.my_people
    from: home
    to: not_home
    for:
      hours: 0
      minutes: 5
      seconds: 0
    alias: When Familjen is away
  - platform: numeric_state
    entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
    for:
      hours: 0
      minutes: 5
      seconds: 0
    above: 400
    alias: When Bright
  condition:
  - condition: or
    conditions:
    - condition: and
      conditions:
      - condition: numeric_state
        entity_id: sun.sun
        above: 5
        attribute: elevation
        alias: Sun above 5°
      - condition: numeric_state
        entity_id: sensor.lumi_lumi_sen_ill_agl01_illuminance
        above: 400
        alias: Bright
      alias: Is Bright and Sun > 5°
      enabled: true
    - condition: sun
      after: sunset
    - condition: state
      entity_id: group.my_people
      state: not_home
      enabled: true
    alias: Bright day, after sunset or nobody home
    enabled: true
  - condition: sun
    after: sunset
    enabled: false
  action:
  - service: script.turn_off_general_lights
    data: {}
  mode: single
- id: '180109222801'
  alias: Belysning tänd, Utomhus
  description: ''
  trigger:
  - at: 05:30:00
    platform: time
  - platform: time
    at: 08:00:00
  - platform: sun
    event: sunset
    offset: 0
  condition:
  - condition: or
    conditions:
    - condition: sun
      after: sunset
    - condition: and
      conditions:
      - condition: sun
        before: sunrise
      - condition: or
        conditions:
        - condition: time
          after: 05:30:00
          weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
        - condition: time
          after: 08:00:00
          weekday:
          - sat
          - sun
        alias: 05:30 on weekdays or 08:00 on weekends
      alias: Before sunrise and at 05:30 or 08:00
  action:
  - service: script.turn_on_outdoor
    data: {}
- id: '180109222803'
  alias: Belysning släck, Utomhus
  description: ''
  trigger:
  - platform: sun
    event: sunrise
  - platform: time
    at: '23:55:00'
  action:
  - service: script.turn_off_outdoor
    data: {}
- id: '1610304172777'
  alias: Ladda bilen, SoC <20%
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ev6_ev_charge_port
    to: 'on'
  condition:
  - condition: numeric_state
    entity_id: sensor.ev6_ev_battery_level
    below: '20'
  - condition: state
    entity_id: device_tracker.ev6_location
    state: home
  - condition: numeric_state
    entity_id: sensor.framsidan_temperature
    below: 5
  action:
  - service: automation.turn_on
    entity_id: automation.laddat_till_20
  - service: script.charge_the_tesla
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1610304940192'
  alias: Ladda bilen, stoppa, SoC ≥20%
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.ev6_ev_battery_level
    above: '20'
  condition:
  - condition: state
    entity_id: binary_sensor.ev6_ev_battery_charge
    state: Charging
  - condition: state
    entity_id: device_tracker.ev6_location
    state: home
  action:
  - if:
    - condition: state
      entity_id: binary_sensor.low_price
      state: 'off'
    then:
    - service: script.ladda_tesla_stoppa
      data: {}
    else:
    - service: notify.mobile_app_op9_pro
      data:
        message: EV6 har nått SoC {{ states("sensor.ev6_ev_battery_level") }}%
        title: EV6 laddar fortfarande pga. lågt elpris.
  - service: automation.turn_off
    entity_id: automation.laddat_till_20
  mode: single
- id: '1633032752936'
  alias: Belysning tänd, Tidig morgon
  description: ''
  trigger:
  - platform: time
    at: 05:30
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  - condition: sun
    before: sunrise
  action:
  - service: script.early_morning_lights_on
    data: {}
  mode: single
- id: '1643056235541'
  alias: Ladda RYA, lågt elpris
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ev6_ev_charge_port
    to: 'on'
    enabled: false
  - platform: time
    at: sensor.template_next_charge
  condition:
  - condition: state
    entity_id: device_tracker.ev6_location
    state: home
  - condition: state
    entity_id: binary_sensor.ev6_ev_charge_port
    state: 'on'
  - alias: Passed Start time
    condition: template
    value_template: '{{ as_timestamp(now()) >= as_timestamp(as_timestamp(states("sensor.template_next_charge"))|timestamp_local)
      }}'
  - condition: not
    conditions:
    - condition: state
      entity_id: binary_sensor.ev6_ev_battery_charge
      state: 'on'
    alias: EV6 not charging
  - condition: numeric_state
    entity_id: sensor.ev6_ev_battery_level
    below: number.ev6_ac_charging_limit
    alias: EV6 SoC < Charging limit
  action:
  - service: script.turn_on
    data: {}
    target:
      entity_id: script.charge_the_tesla
  - service: script.ladda_bilen_uppstart
    data: {}
    enabled: false
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id: automation.ladda_bilen_nar_det_ar_billigt
  mode: single
- id: '1643296123979'
  alias: Ladda RYA, stoppa
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.low_price
    to: 'off'
  condition:
  - condition: state
    entity_id: device_tracker.ev6_location
    state: home
  - condition: numeric_state
    entity_id: sensor.ev6_ev_battery_level
    above: '20'
  - condition: state
    entity_id: binary_sensor.low_price
    state: 'off'
  - condition: state
    entity_id: binary_sensor.ev6_ev_battery_charge
    state: 'on'
  - condition: state
    entity_id: automation.ladda_bilen_nar_det_ar_billigt
    state: 'on'
    alias: Confirm automation Ladda vid lågt pris is on
  action:
  - service: script.ladda_tesla_stoppa
    data: {}
  mode: single
- id: '1652813052285'
  alias: Wall-E, fellarm
  description: ''
  trigger:
  - platform: state
    entity_id:
    - vacuum.wall_e
    to: error
    id: error_trigger
  - platform: state
    entity_id:
    - vacuum.wall_e
    for:
      hours: 0
      minutes: 20
      seconds: 0
    to: returning
  condition:
  - condition: template
    value_template: '{{ state_attr("vacuum.wall_e", "error").description != ''rain
      delay'' }}'
    alias: Error NOT 'rain delay'
  - condition: and
    conditions:
    - condition: trigger
      id:
      - error_trigger
    - condition: template
      value_template: '{{ state_attr("vacuum.wall_e", "error").description != ''no
        error'' }}'
      alias: NOT 'no error'
    alias: Triggered by error and NOT 'no error'
  action:
  - service: notify.mobile_app_op9_pro
    data:
      message: 'Fel på gräsklipparen ({{ state_attr("vacuum.wall_e", "error").description
        }}). Status: {{states(''vacuum.wall_e'')}}. Batteri {{ state_attr("vacuum.wall_e",
        "battery_level") }}%.'
      title: Wall-E larm
  mode: single
- id: '1656709628350'
  alias: Ladda Zoe:n, klocka
  description: ''
  trigger:
  - platform: time
    at: input_datetime.zoe_hour
  condition: []
  action:
  - service: script.ladda_zoe
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1657529930391'
  alias: Elpriser, notifiera
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.template_nordpool_tomorrow_valid
    to: 'on'
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      message: "Nu är morgondagens priser uppdaterade.\\n avg: {{states(\"sensor.template_nordpool_tomorrow_avg\")}}
        kr\\n min: {{states(\"sensor.template_nordpool_tomorrow_min\")}} kr\\n max:
        {{states(\"sensor.template_nordpool_tomorrow_max\")}} kr\\n{% for price in
        state_attr('sensor.nordpool_kwh_se3_sek_3_095_0', 'tomorrow') -%}\n  {{ '{:02d}:
        {:.1f}'.format((loop.index-1), price|float(0) * 125) -}}\n  {{ \", \" if not
        loop.last else \"\" -}}\n{% endfor %}"
      title: Elpriset uppdaterat
  mode: single
- id: '1659106208657'
  alias: Wall-E, dags att byta blad
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.template_walle_blade_hours
    above: 100
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      title: Dags att byta knivar på Wall-E
      message: Bladen har använts i {{ (state_attr("vacuum.wall_e","blades").current_on
        | int / 60) | round(0) }} timmar.
  mode: single
- id: '1661109418803'
  alias: 'Ladda Azarel: på klocka'
  description: ''
  trigger:
  - platform: time
    at: input_datetime.azarel_hour
  condition:
  - condition: state
    entity_id: device_tracker.azarel_location_tracker
    state: home
  - condition: state
    entity_id: binary_sensor.azarel_charger
    state: 'on'
  - condition: state
    entity_id: binary_sensor.low_price
    state: 'on'
    enabled: false
  action:
  - service: script.charge_the_tesla
    data: {}
  - service: script.ladda_bilen_uppstart
    data: {}
  mode: single
- id: '1662395114345'
  alias: Värmepumpen, tillåt elpatron
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.low_price
    alias: When Cheap
    to: 'on'
  - platform: numeric_state
    entity_id: sensor.hem_gen5_electric_consumed_2
    below: 16
  condition:
  - condition: state
    entity_id: binary_sensor.low_price
    state: 'on'
  action:
  - service: switch.turn_off
    data: {}
    target:
      entity_id:
      - switch.varmepumpen_b
      - switch.varmepumpen_a
  mode: single
- id: '1662395326862'
  alias: Värmepumpen, blockera elpatron
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.low_price
    alias: When expensive
    to: 'off'
    id: evt_expensive
  - platform: numeric_state
    entity_id: sensor.hem_gen5_electric_consumed_3
    above: 20
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.varmepumpen_a
    alias: Turn off VP Heat
  - if:
    - condition: state
      entity_id: binary_sensor.low_price
      state: 'off'
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.varmepumpen_a
    alias: If expensive block completely
  - delay:
      hours: 0
      minutes: 0
      seconds: 6
      milliseconds: 0
  - if:
    - condition: numeric_state
      entity_id: sensor.hem_gen5_electric_consumed_2
      above: 21
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.varmepumpen_a
  mode: single
- id: '1662572482443'
  alias: Diskmaskinen, starta på klocka
  description: ''
  trigger:
  - platform: time
    at: input_datetime.diskmaskinen_timme
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.clever_spz3
  - wait_for_trigger:
    - platform: numeric_state
      entity_id: sensor.clever_spz3_electric_consumption_w
      for:
        hours: 0
        minutes: 5
        seconds: 0
      below: 4
  - service: automation.turn_off
    alias: Turn off automation
    data: {}
    target:
      entity_id: automation.diskmaskinen_starta_pa_klocka
  mode: single
- id: '1662626703155'
  alias: Ladda Zoe, stoppa
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.zoe_battery_level'')|int >= states(''input_number.zoe_soc_upper_limit'')|int
      }}'
    enabled: false
  - platform: numeric_state
    entity_id: sensor.zoe_battery_level
    above: input_number.zoe_soc_upper_limit
  condition:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.zoe_upper_limit
      state: 'on'
    - condition: state
      state: charge_in_progress
      entity_id: sensor.zoe_charge_state
    - condition: numeric_state
      entity_id: sensor.zoe_battery_level
      above: input_number.zoe_soc_upper_limit
  action:
  - service: script.1662626875831
    data: {}
  mode: single
- id: '1663015641931'
  alias: Tvättmaskinen, starta på klockslag
  description: ''
  trigger:
  - platform: time
    at: input_datetime.tvattmaskinen_timme
  condition: []
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.clever_spz2
  - wait_for_trigger:
    - platform: numeric_state
      entity_id: sensor.clever_spz2_electric_consumption_w_2
      for:
        hours: 0
        minutes: 2
        seconds: 0
      below: 5
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id: automation.tvattmaskinen_starta_pa_klockslag
  mode: single
- id: '1663084425465'
  alias: 'Tvättmaskinen klar '
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.clever_spz2_electric_consumption_w_2
    above: 1000
  condition: []
  action:
  - wait_for_trigger:
    - platform: numeric_state
      entity_id: sensor.clever_spz2_electric_consumption_w_2
      for:
        hours: 0
        minutes: 2
        seconds: 0
      below: 5
  - service: notify.fridas_devices
    data:
      title: Tvättmaskinen är klar
      message: Tvättmaskinen blev färdig kl. {{ now().strftime('%H:%M den %d/%m')
        }}
  - service: notify.rickards_devices
    data:
      title: Tvättmaskinen är klar
      message: Tvättmaskinen blev färdig kl. {{ now().strftime('%H:%M den %d/%m')
        }}
  mode: single
- id: '1663105406145'
  alias: Spelrummet, LED
  description: ''
  use_blueprint:
    path: niro1987/zha_ikea_tradfri_5button_remote_preset.yaml
    input:
      remote: c53b352f8a5c574b8c18e8cc9b371448
      light: light.spelrummet_taket_light
      preset: input_select.helper_spelrummet_led
- id: '1663141580671'
  alias: ALARM, ChargeNode offline
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.chargenode_pie
    to: 'off'
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      title: Laddaren offline!
      message: Det går inte att nå ChargeNode-laddaren!
      data:
        push:
          sound:
            name: default
            critical: 1
            volume: 1
        channel: Alarm
        ttl: 0
        priority: high
  mode: single
- id: '1664118673084'
  alias: Tvättstugan, LED
  description: ''
  use_blueprint:
    path: niro1987/zha_ikea_tradfri_5button_remote_preset.yaml
    input:
      remote: 6a70347d6c5f0791963cff2b5e01c92b
      light: light.tvattstugan_banken_light
      preset: input_select.helper_spelrummet_led
- id: '1664611841028'
  alias: Check Cleverio status
  description: ''
  trigger:
  - platform: time_pattern
    hours: /1
  condition: []
  action:
  - service: button.press
    data: {}
    target:
      entity_id:
      - button.node_15_ping
      - button.node_17_ping
      - button.node_18_ping
  mode: single
- id: '1664994425706'
  alias: iGrill alarm
  description: ''
  trigger:
  - platform: template
    value_template: '{{ states(''sensor.igrill_probe_1'')|int >= states(''input_number.igrill_target_temp'')|int
      }}'
    alias: 'When at target temp '
  - platform: template
    value_template: '{{ states(''sensor.igrill_probe_1'')|int >= states(''input_number.igrill_target_temp'')|int-3
      }}'
    alias: 'When right before target temp '
  condition: []
  action:
  - if:
    - condition: template
      value_template: '{{ states(''sensor.igrill_probe_1'')|int >= states(''input_number.igrill_target_temp'')|int
        }}'
      alias: 'At target temp '
    then:
    - service: notify.rickards_devices
      data:
        title: iGrill alarm
        message: Temperaturen är {{ states.sensor.igrill_probe_1.state|int }}°C.
    else:
    - service: notify.rickards_devices
      data:
        title: iGrill alarm
        message: Temperaturen är strax där {{ states.sensor.igrill_probe_1.state|int
          }}°C ({{ states.input_number.igrill_target_temp.state|int }}°).
  mode: single
- id: '1671363832692'
  alias: 'ALARM: Enheter offline'
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.node_18_node_status
    - sensor.node_17_node_status
    from: alive
    for:
      hours: 0
      minutes: 2
      seconds: 0
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      message: Tvätt- eller diskmaskinen är offline.
      title: Enheter är offline
  mode: single
- id: '1672646126224'
  alias: Förrådet, Turn On Heat
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.199_temperature
    below: 10
    alias: When Förrådet temp <10
  - platform: state
    entity_id:
    - binary_sensor.template_nordpool_price_low
    to: 'on'
  condition:
  - condition: state
    entity_id: binary_sensor.template_nordpool_price_low
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.199_temperature
    below: 10
    alias: When Förrådet is <10°
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: switch.popp_outdoor
  mode: single
- id: '1672652238394'
  alias: Förrådet, Turn Off Heat
  description: ''
  trigger:
  - alias: When Förrådet >12°
    platform: numeric_state
    entity_id: sensor.199_temperature
    above: 12
  - platform: state
    entity_id:
    - binary_sensor.template_nordpool_price_low
    to: 'off'
  condition: []
  action:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id: switch.popp_outdoor
  mode: single
- id: '1673507757148'
  alias: Belysning tänd, Arbetsdagar
  description: ''
  trigger:
  - platform: time
    at: 08:00:00
  condition:
  - condition: time
    weekday:
    - thu
    - fri
    - mon
    alias: On Mon, Thu, Fri
  - condition: template
    value_template: '{{ state_attr("sun.sun", "elevation") < 5 }}'
    alias: Before Sunrise
  - condition: state
    entity_id: person.rickard_nord
    state: home
    for:
      hours: 0
      minutes: 5
      seconds: 0
  action:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id: group.kontoret
    alias: Turn on Kontoret
  mode: single
- id: '1675949713517'
  alias: Spabadet, pump and heater
  description: ''
  trigger:
  - platform: time_pattern
    hours: /1
    alias: Every hour
  - alias: When hot tub temp >31°
    platform: numeric_state
    entity_id: sensor.template_spabadet_temperature
    above: 31
  condition: []
  action:
  - delay:
      hours: 0
      minutes: 0
      seconds: 5
      milliseconds: 0
  - service: script.turn_on
    data: {}
    target:
      entity_id: script.spabadet_pump_and_heater_v2
    alias: Run Spabadet, pump and heater (V2)
  mode: single
- id: '1677244066232'
  alias: Spabadet, larm om värmen
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.spabadet_l3_power
    for:
      hours: 0
      minutes: 5
      seconds: 0
    above: 0.5
  condition:
  - condition: numeric_state
    entity_id: sensor.spabadet_l2_power
    below: 1
  - condition: state
    entity_id: switch.spabadet_l2
    state: 'on'
  - condition: numeric_state
    entity_id: sensor.template_spabadet_temperature
    below: 34
  - condition: numeric_state
    entity_id: sensor.template_spabadet_l3_current_a
    above: 0.5
  action:
  - service: notify.rickards_devices
    data:
      message: Värmen är på men drar ingen ström.
      title: Spabadet
  mode: single
- id: '1684931331914'
  alias: 'Wall-E: Query Status'
  description: Tvinga uppdatering av Wall-E
  trigger:
  - platform: time_pattern
    hours: /1
  condition:
  - condition: time
    after: '10:00:00'
    before: '18:00:00'
    alias: Between 10 and 18
  - condition: template
    value_template: '{{ (as_timestamp(now()) - as_timestamp(state_attr(''vacuum.wall_e'',''state_updated_at''),0))
      > 3600 }}'
    alias: Updated at least an hour ago
  action:
  - service: landroid_cloud.partymode
    data:
      party_mode_enabled: false
    target:
      device_id: 04744719de96abcefa75f8ffeeb42a05
    alias: Disable Wall-E Party Mode
  mode: single
- id: '1685565293861'
  alias: Ladda Zoe, inkopplad
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.zoe_plug
    to: 'on'
    from: 'off'
  condition:
  - condition: numeric_state
    entity_id: sensor.zoe_battery_level
    below: input_number.zoe_soc_upper_limit
  action:
  - service: automation.turn_on
    data: {}
    target:
      entity_id: automation.zoe_charge
  mode: single
- id: '1685708337936'
  alias: Spabadet, still running manually notification
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_boolean.spabadet_manual
    to: 'on'
    for:
      hours: 4
      minutes: 0
      seconds: 0
  condition: []
  action:
  - service: notify.rickards_devices
    data:
      message: Spabadet kör fortfarande manuellt.
  - delay:
      hours: 2
      minutes: 0
      seconds: 0
      milliseconds: 0
  - if:
    - condition: state
      entity_id: input_boolean.spabadet_manual
      state: 'on'
    then:
    - service: notify.rickards_devices
      data:
        message: Spabadet kör fortfarande manuellt efter 6 timmar…
  mode: single
- id: '1685775877485'
  alias: Ladda Zoe, stäng av automation
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.zoe_charging
    to: 'on'
  condition: []
  action:
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id: automation.zoe_charge
  mode: single
- id: '1690820037786'
  alias: Ladda RYA, set charge limit
  description: ''
  trigger:
  - platform: state
    entity_id:
    - input_number.rya_soc_upper_limit
    for:
      hours: 0
      minutes: 0
      seconds: 10
  - platform: state
    entity_id:
    - number.ev6_ac_charging_limit
  condition:
  - condition: template
    value_template: '{{ states(''number.ev6_ac_charging_limit'')|int(0) != states(''input_number.rya_soc_upper_limit'')|int(0)
      }}'
  action:
  - service: kia_uvo.set_charge_limits
    data:
      ac_limit: '{{ states("input_number.rya_soc_upper_limit")|int(80) }}'
    alias: Set charge limit to Rya SoC Upper Limit
    enabled: false
  - if:
    - condition: template
      value_template: '{{ states.number.ev6_ac_charging_limit.state == 0 }}'
      alias: EV6 is 0
    then:
    - service: number.set_value
      alias: Set EV6 Charging Limit to SoC Upper Limit
      target:
        entity_id: number.ev6_ac_charging_limit
      data:
        value: '{{ states(''input_number.rya_soc_upper_limit'')|int(80) }}'
    else:
    - if:
      - condition: template
        value_template: '{{ trigger.entity_id == ''number.ev6_ac_charging_limit''
          }}'
        alias: Triggered by ev6_ac_charging_limit
      - condition: numeric_state
        entity_id: number.ev6_ac_charging_limit
        above: 49
      then:
      - service: input_number.set_value
        alias: Set SoC Upper Limit to EV6 Charging Limit
        target:
          entity_id: input_number.rya_soc_upper_limit
        data:
          value: '{{ states(''number.ev6_ac_charging_limit'')|int }}'
      else:
      - service: number.set_value
        alias: Set EV6 Charging Limit to SoC Upper Limit
        target:
          entity_id: number.ev6_ac_charging_limit
        data:
          value: '{{ states(''input_number.rya_soc_upper_limit'')|int(80) }}'
  mode: single
- id: '1690871828303'
  alias: EV6, reload config
  description: Reload EV6 configuration when it becomes unavailable
  trigger:
  - platform: state
    entity_id:
    - sensor.ev6_odometer
    to: unknown
    for:
      hours: 0
      minutes: 0
      seconds: 30
  - platform: state
    entity_id:
    - sensor.ev6_odometer
    to: unavailable
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition: []
  action:
  - service: homeassistant.reload_config_entry
    data: {}
    target:
      device_id: f4c09575234da651122f411210842a80
  mode: single
- id: '1690876033170'
  alias: EV6, reload when charging
  description: Reload EV6 status every 15 min when charging
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.ev6_ev_charge_port
    to: 'on'
    id: Cp_open
  - platform: numeric_state
    entity_id: sensor.template_rya_charging_power
    above: 0.1
  condition: []
  action:
  - if:
    - condition: trigger
      id:
      - Cp_open
    then:
    - service: automation.turn_on
      data: {}
      target:
        entity_id: automation.ladda_bilen_nar_det_ar_billigt
    alias: Enable Automation Ladda RYA
  - repeat:
      while:
      - condition: state
        entity_id: binary_sensor.ev6_ev_charge_port
        state: 'on'
      - condition: numeric_state
        entity_id: sensor.template_rya_charging_power
        above: 0.1
      sequence:
      - service: kia_uvo.update
        data: {}
        alias: Refresh EV6 status
        enabled: false
      - delay:
          hours: 0
          minutes: 15
          seconds: 0
          milliseconds: 0
        enabled: true
      - service: kia_uvo.force_update
        data: {}
        alias: Force refresh EV6 status
        enabled: true
  mode: single
- id: '1693808329866'
  alias: Tvättmaskinen, armera
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.clever_spz2_electric_consumption_w_2
    for:
      hours: 0
      minutes: 0
      seconds: 5
    above: 10
  condition:
  - condition: state
    entity_id: automation.tvattmaskinen_starta_pa_klockslag
    state: 'on'
  action:
  - service: switch.turn_off
    data: {}
    target:
      entity_id: switch.clever_spz2
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id: automation.tvattmaskinen_starta
  mode: single
- id: '1693809436762'
  alias: Diskmaskinen, armera
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.clever_spz3_electric_consumption_w
    for:
      hours: 0
      minutes: 0
      seconds: 5
    above: 5
  condition:
  - condition: state
    entity_id: automation.diskmaskinen_starta_pa_klocka
    state: 'on'
  action:
  - service: switch.turn_off
    data: {}
    target:
      entity_id:
      - switch.clever_spz3
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id:
      - automation.diskmaskinen_armera
  mode: single
- id: '1695920348544'
  alias: Värmepumpen, styrning
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.template_nordpool_price_not_high
    to: 'on'
    alias: When not expensive
    id: not_expensive
  - platform: state
    entity_id:
    - binary_sensor.template_nordpool_price_not_high
    to: 'off'
    id: expensive
    alias: When expensive
  - platform: numeric_state
    entity_id:
    - sensor.felix_rum_temperature
    below: 23
    alias: When Temp goes below 23°
    enabled: true
  - alias: When Temp goes above 23°
    platform: numeric_state
    entity_id:
    - sensor.felix_rum_temperature
    above: 22.9
    enabled: true
  condition: []
  action:
  - alias: When expensive turn off heat
    if:
    - condition: numeric_state
      entity_id: sensor.felix_rum_temperature
      above: 23
      enabled: true
    - condition: state
      entity_id: binary_sensor.template_nordpool_price_not_high
      state: 'off'
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.varmepumpen_a
  - alias: When not expensive turn on heat and warm water
    if:
    - alias: When Not Expensive OR Temp<23°
      condition: or
      conditions:
      - condition: numeric_state
        entity_id:
        - sensor.felix_rum_temperature
        below: 23
        alias: When Temp goes below 23°
        enabled: true
      - condition: state
        entity_id: binary_sensor.template_nordpool_price_not_high
        state: 'on'
    then:
    - service: switch.turn_off
      data: {}
      target:
        entity_id:
        - switch.varmepumpen_a
        - switch.varmepumpen_b
  mode: single
- id: '1698044468504'
  alias: Elpriset, indikator
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.nordpool_kwh_se3_sek_3_095_0
  condition: []
  action:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.template_nordpool_price_not_high
        state: 'off'
        alias: Över 75:e percentilen
      sequence:
      - service: zwave_js.set_config_parameter
        data:
          parameter: '41'
          value: '4'
        target:
          device_id: aa0c0b41292d62cfbef2a78d19659e46
        alias: Röd
    - conditions:
      - condition: state
        entity_id: binary_sensor.template_nordpool_price_not_high
        state: 'on'
        alias: Under 75:e percentilen
      - condition: state
        entity_id: binary_sensor.template_nordpool_price_reallow
        state: 'off'
        alias: Över 25:e percentilen
      sequence:
      - alias: Gul
        service: zwave_js.set_config_parameter
        data:
          parameter: '41'
          value: '7'
        target:
          device_id: aa0c0b41292d62cfbef2a78d19659e46
    - conditions:
      - condition: state
        entity_id: binary_sensor.template_nordpool_price_reallow
        state: 'on'
        alias: Under 25:e percentilen
      sequence:
      - service: zwave_js.set_config_parameter
        data:
          parameter: '41'
          value: '5'
        target:
          device_id: aa0c0b41292d62cfbef2a78d19659e46
        alias: Grön
  mode: single
- id: '1698589680106'
  alias: Belysning, sovrumsfönstet
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 561658b47089ec170430b3a90235e3ed
    entity_id: 0deaeb905f1732723e5b47094a620148
    domain: light
    id: window_on
  - platform: device
    type: turned_off
    device_id: 561658b47089ec170430b3a90235e3ed
    entity_id: 0deaeb905f1732723e5b47094a620148
    domain: light
    id: window_off
  - platform: state
    entity_id: light.sovrummet_fonstret
    attribute: brightness
    id: window_brightness
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id:
        - window_on
      sequence:
      - service: light.turn_on
        data: {}
        target:
          entity_id: light.sovrumsfonstret
    - conditions:
      - condition: trigger
        id:
        - window_off
      sequence:
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.sovrumsfonstret
    - conditions:
      - condition: trigger
        id:
        - window_brightness
      sequence:
      - service: light.turn_on
        data:
          brightness: '{{ state_attr(''light.sovrummet_fonstret'',''brightness'')|int}}'
        target:
          entity_id: light.sovrumsfonstret
  mode: single
- id: '1699456441373'
  alias: EV6, scheduled HVAC
  description: Starta luftkonditionering i bilen på klocka
  trigger:
  - platform: time
    at: input_datetime.rya_starta_hvac
  condition: []
  action:
  - service: script.turn_on
    data: {}
    target:
      entity_id: script.ev6_start_hvac
    alias: Start HVAC
  - delay:
      hours: 0
      minutes: 0
      seconds: 20
      milliseconds: 0
    alias: Delay 20 secs
  - service: notify.rickards_devices
    data:
      title: A/C på Kian
      message: 'Luftkonditioneringen på RYA är startad.\n A/C: {{states(''sensor.ev6_set_temperature'')}}°
        {{''(på)'' if states(''binary_sensor.ev6_air_conditioner'')|bool else ''(av)''}}\n
        SoC: {{states(''sensor.ev6_ev_battery_level'')}}%.\n {{now().strftime(''%m-%d
        %H:%M'')}}'
    alias: Notify A/C started
  - service: automation.turn_off
    data:
      stop_actions: false
    target:
      entity_id: automation.ev6_scheduled_hvac
    alias: Turn off automation
  mode: single
- id: '1699623900896'
  alias: Zoe, reload config
  description: ''
  trigger:
  - platform: state
    entity_id:
    - sensor.zoe_battery_level
    to: unavailable
    for:
      hours: 0
      minutes: 5
      seconds: 0
  condition: []
  action:
  - service: homeassistant.reload_config_entry
    data: {}
    target:
      device_id: ffd6fdd0eebca8d7951b4008604c2c94
  mode: single
- id: '1699976122787'
  alias: Zoe, charge
  description: ''
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.zoe_plug
    to: 'on'
    enabled: false
  - platform: time
    at: sensor.template_next_charge
    alias: When at Start time
  condition:
  - condition: numeric_state
    entity_id: sensor.zoe_battery_level
    below: input_number.zoe_soc_upper_limit
  - condition: template
    value_template: '{{ now() >= as_datetime(states("sensor.template_next_charge"))
      }}'
    alias: Passed Start time
  - condition: state
    entity_id: binary_sensor.zoe_charging
    state: 'off'
  action:
  - service: script.turn_on
    data: {}
    target:
      entity_id: script.ladda_zoe
    enabled: true
  - service: script.ladda_bilen_uppstart
    data: {}
    enabled: false
  mode: single
