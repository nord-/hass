turn_on_felix_rum:
  alias: Tänd Felix rum
  sequence:
  - service: homeassistant.turn_on
    data:
      entity_id: group.felix_rum
turn_off_felix_rum:
  alias: Släck Felix rum
  sequence:
  - service: homeassistant.turn_off
    data:
      entity_id: group.felix_rum
turn_on_uppe:
  alias: Tänd övervån
  sequence:
  - service: switch.turn_on
    data:
      entity_id:
      - group.vrum_uppe
      - group.sovrummet
      - group.kontoret
  - service: light.turn_on
    data:
      entity_id:
      - group.kontoret
turn_off_uppe:
  alias: Släck övervån
  sequence:
  - service: script.slack_sovrummet
  - service: switch.turn_off
    data: {}
    target:
      entity_id:
      - group.vrum_uppe
      - group.kontoret
      - switch.nexa_1
  - service: light.turn_off
    data:
      entity_id:
      - group.kontoret
  mode: single
turn_on_nere:
  alias: Tänd undervån
  sequence:
  - service: homeassistant.turn_on
    data:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.vrum_nere
      - group.hallen
      - group.gastrummet
      - group.felix_rum
  - service: light.turn_on
    data:
      entity_id:
      - group.vrum_nere
      - group.koket
    enabled: false
  mode: single
turn_off_nere:
  alias: Släck undervån
  sequence:
  - service: homeassistant.turn_off
    data:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.vrum_nere
      - group.hallen
      - group.gastrummet
      - group.felix_rum
  - service: light.turn_off
    data:
      entity_id:
      - group.vrum_nere
      - group.koket
    enabled: false
  mode: single
turn_on_general_lights:
  alias: Tänd allmän belysning
  sequence:
  - service: homeassistant.turn_on
    data:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.vrum_nere
      - group.hallen
      - group.gastrummet
      - group.sovrummet
      - group.vrum_uppe
      - group.kontoret
  - service: light.turn_on
    data:
      entity_id:
      - group.vrum_nere
      - group.koket
      - group.kontoret
    enabled: false
  mode: single
turn_off_general_lights:
  alias: Släck allmän belysning
  sequence:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.vrum_nere
      - group.hallen
      - group.gastrummet
      - group.vrum_uppe
      - group.kontoret
      - switch.rusta13a
      - switch.rusta13c
      - group.sovrummet
  - service: light.turn_off
    data:
      entity_id:
      - group.vrum_nere
      - group.koket
      - group.kontoret
      - group.gastrummet
    enabled: false
  - service: script.slack_sovrummet
    data: {}
    enabled: false
  mode: single
turn_off_all:
  alias: Stäng av allt
  sequence:
  - service: homeassistant.turn_off
    data:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.vrum_nere
      - group.hallen
      - group.gastrummet
      - group.sovrummet
      - group.vrum_uppe
      - group.kontoret
      - group.felix_rum
      - group.ute
  - service: light.turn_off
    data:
      entity_id:
      - group.vrum_nere
      - group.koket
      - group.kontoret
    enabled: false
  mode: single
turn_on_outdoor:
  alias: Slå på utomhusbelysning
  sequence:
  - service: switch.turn_on
    data:
      entity_id: group.ute
turn_off_outdoor:
  alias: Slå av utomhusbelysning
  sequence:
  - service: switch.turn_off
    data:
      entity_id: group.ute
turn_on_all_lights:
  alias: Tänd belysning
  sequence:
  - service: homeassistant.turn_on
    data:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.vrum_nere
      - group.hallen
      - group.gastrummet
      - group.sovrummet
      - group.vrum_uppe
      - group.kontoret
      - group.felix_rum
  - service: light.turn_on
    data:
      entity_id:
      - group.vrum_nere
      - group.koket
      - group.kontoret
    enabled: false
  mode: single
turn_on_morning_lights:
  alias: Tänd morgonbelysning
  sequence:
  - data: {}
    service: switch.turn_on
    target:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.vrum_nere
      - group.hallen
      - group.kontoret
      - switch.nexa_1
      - switch.rusta25b
  - data:
      entity_id:
      - group.vrum_nere
      - group.koket
      - group.kontoret
    service: light.turn_on
  mode: single
early_morning_lights_on:
  alias: Tänd tidig morgon
  sequence:
  - service: homeassistant.turn_on
    data: {}
    target:
      entity_id:
      - group.grovkoket
      - group.koket
      - group.hallen
      - switch.nexa_1
      - switch.rusta25b
  - service: light.turn_on
    data: {}
    target:
      entity_id:
      - group.koket
    enabled: false
  mode: single
start_the_car:
  alias: Starta bilen
  sequence:
  - service: lock.unlock
    data:
      entity_id:
      - lock.azarel_door_lock
      - lock.azarel_charger_door_lock
  - service: climate.turn_on
    data:
      entity_id: climate.azarel_hvac_climate_system
  mode: single
charge_the_tesla:
  alias: Ladda Teslan
  sequence:
  - service: rest_command.cn_add_aza_to_queue
    data: {}
  - service: notify.rickards_devices
    data:
      title: Azarel börjar ladda
      message: 'Laddningen av Azarel har startat.\n SoC:     {{ states("sensor.azarel_battery_sensor")
        }}%.\n Priset:  {{ states("sensor.template_nordpool_current_price_vat") }}
        kr\n Klockan: {{ now().strftime(''%H:%M den %d/%m'') }}'
  mode: single
  icon: mdi:ev-station
tand_sovrummet:
  sequence:
  - service: switch.turn_on
    target:
      entity_id:
      - switch.nexa_3
      - switch.nexa_4
      - switch.spelrummet_ljusslingan
    data: {}
  - service: script.early_morning_lights_on
    data: {}
  - service: light.turn_on
    target:
      entity_id: light.office_window
    data: {}
  mode: single
  alias: Tänd sovrummet
slack_sovrummet:
  sequence:
  - service: switch.turn_off
    target:
      entity_id: switch.nexa_4
    data: {}
  - delay:
      hours: 0
      minutes: 0
      seconds: 3
      milliseconds: 0
  - service: switch.turn_off
    target:
      entity_id: switch.nexa_3
    data: {}
  mode: single
  alias: Släck sovrummet
slack_inne:
  sequence:
  - service: homeassistant.turn_off
    data: {}
    target:
      entity_id:
      - group.hallen
      - switch.rusta13c
      - switch.rusta13a
      - group.gastrummet
      - group.grovkoket
      - switch.nexa_1
      - switch.tz2
  mode: single
  alias: Släck inne
  icon: mdi:lightbulb-group-off-outline
ladda_zoe:
  alias: Ladda Zoe
  sequence:
  - service: rest_command.cn_add_yxx_to_queue
    data: {}
  - service: notify.rickards_devices
    data:
      message: 'Laddningen av Zoe har startat.\n SoC:     {{ states("sensor.zoe_battery_level")
        }}%.\n Priset:  {{ states("sensor.template_nordpool_current_price_vat") }}
        kr\n Klockan: {{ now().strftime(''%H:%M den %d/%m'') }}'
      title: Zoe lagd i kö
  mode: single
  icon: mdi:ev-station
ladda_tesla_stoppa:
  alias: Ladda Tesla, stoppa
  sequence:
  - service: rest_command.cn_remove_aza_from_queue
    data: {}
  - service: notify.rickards_devices
    data:
      message: 'Laddningen av Azarel har stoppats.\n SoC:     {{ states("sensor.azarel_battery_sensor")
        }}%.\n Priset:  {{ states("sensor.template_nordpool_current_price_vat") }}
        kr\n Klockan: {{ now().strftime(''%H:%M den %d/%m'') }}'
      title: Azarel har slutat ladda
  mode: single
  icon: mdi:ev-station
'1661376120898':
  alias: Azarel Set Charge Limit SOC
  mode: restart
  sequence:
  - service: tesla_custom.api
    data:
      command: CHANGE_CHARGE_LIMIT
      parameters:
        path_vars:
          vehicle_id: '{{ state_attr(''binary_sensor.azarel_online_sensor'', ''id'')
            }}'
        percent: '{{ states(''input_number.aza_charge_limit'') | int(default=80) }}'
        wake_if_asleep: true
'1662626875831':
  alias: Ladda Zoe, stoppa
  sequence:
  - service: rest_command.cn_remove_yxx_from_queue
    data: {}
  - service: notify.rickards_devices
    data:
      message: 'Laddningen av Zoe har stoppats.\n SoC:     {{ states("sensor.zoe_battery_level")
        }}%.\n Priset:  {{ states("sensor.template_nordpool_current_price_vat") }}
        kr\n Klockan: {{ now().strftime(''%H:%M den %d/%m'') }}'
      title: Zoe har slutat ladda
  mode: single
  icon: mdi:ev-station
ladda_bilen_uppstart:
  alias: Ladda bilarna, uppstart
  sequence:
  - service: switch.turn_off
    data: {}
    target:
      entity_id: switch.spabadet_l2
  - service: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.varmepumpen_a
      - switch.varmepumpen_b
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - if:
    - condition: state
      entity_id: sensor.nordpool_kwh_se3_sek_3_095_0
      attribute: low price
      state: true
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.spabadet_l2
    - service: switch.turn_off
      data: {}
      target:
        entity_id:
        - switch.varmepumpen_a
        - switch.varmepumpen_b
  mode: single
  icon: mdi:ev-station
spabadet_pause_control:
  alias: Spabadet, pause control
  sequence:
  - service: script.turn_off
    data: {}
    target:
      entity_id:
      - script.spabadet_pump_and_heater
    alias: Take manual control of pumps and heater
  - service: automation.turn_off
    data: {}
    target:
      entity_id:
      - automation.spabadet_run_pumps_for_2_hours
  - service: switch.turn_on
    data: {}
    target:
      entity_id:
      - switch.spabadet_l3
    alias: Turn on pumps
  - if:
    - condition: state
      entity_id: input_boolean.overcurrent_l2
      state: 'off'
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.spabadet_l2
    alias: If heater not stopped by high load, turn on heater
  - delay:
      hours: 1
      minutes: 15
      seconds: 0
      milliseconds: 0
  - service: automation.turn_on
    data: {}
    target:
      entity_id: automation.spabadet_run_pumps_for_2_hours
    alias: Release manual control of pumps and heater
  mode: single
  icon: mdi:swim
spabadet_pump_and_heater:
  alias: Spabadet, pump and heater
  sequence:
  - if:
    - condition: or
      conditions:
      - condition: time
        after: 00:00:00
        before: 02:00:00
      - condition: time
        after: 08:00:00
        before: '10:00:00'
      - condition: time
        after: '16:00:00'
        before: '18:00:00'
      alias: Time 00, 08, 16
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id: switch.spabadet_l3
      alias: Turn on pumps
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - if:
    - condition: state
      entity_id: sensor.nordpool_kwh_se3_sek_3_095_0
      attribute: low price
      state: true
      alias: Low price
    then:
    - service: switch.turn_on
      data: {}
      target:
        entity_id:
        - switch.spabadet_l3
        - switch.spabadet_l2
      alias: Turn on pumps and heater
    - service: notify.rickards_devices
      data:
        message: Värmen har slagits på.
    alias: Turn on heater if low price
  - delay:
      hours: 1
      minutes: 0
      seconds: 0
      milliseconds: 0
  - if:
    - condition: or
      conditions:
      - condition: numeric_state
        entity_id: sensor.framsidan_temperature
        above: 5
      - condition: numeric_state
        entity_id: sensor.badet_temperature
        above: 32
      alias: Temp is >5° or spabadet >32°
    then:
    - service: switch.turn_off
      data: {}
      target:
        entity_id:
        - switch.spabadet_l3
        - switch.spabadet_l2
      alias: Turn off pumps and heater
    alias: If temp is >5° or spabadet >32° turn off
  - service: input_boolean.turn_off
    data: {}
    target:
      entity_id: input_boolean.overcurrent_l2
    alias: Turn off high load flag
  mode: single
  icon: mdi:pump
