cn_add_rya_to_queue:
  url: "https://dev-app-cn.azurewebsites.net/chargingbox/charge"
  method: post
  headers: 
    authorization: !secret cn_rest_authorization
    accept: 'text/plain, application/json, text/json'
  content_type:  'application/json; charset=utf-8'
  payload: '{ "portId": 510, "userCarId": 590, "departureTime": "{{ (as_timestamp(now()) + 8*60*60) | timestamp_local() }}", "startChargePercentage": {{ states("sensor.ev6_ev_battery_level") }}, "targetChargePercentage": {{ states("number.ev6_ac_charging_limit") | int(80) }} }'
  # 510 uttag 1, 511 uttag 2, 512 uttag 3
  # UserCarId 12 = Azarel, 423 = Zoe, 590 = Kia
  
cn_remove_rya_from_queue:
  url: "https://dev-app-cn.azurewebsites.net/chargingbox/site/37/car/590/stop"
  method: put
  headers: 
    authorization: !secret cn_rest_authorization

cn_add_yxx_to_queue:
  url: "https://dev-app-cn.azurewebsites.net/chargingbox/charge"
  method: post
  headers: 
    authorization: !secret cn_rest_authorization
    accept: 'text/plain, application/json, text/json'
  content_type:  'application/json; charset=utf-8'
  payload: '{ "portId": 511, "userCarId": 423, "departureTime": "{{ int(as_timestamp((now() + timedelta(days=1)).date()) + 6*60*60+1800) | timestamp_local() if (now() > today_at("06:30")) else as_timestamp(today_at("06:30")) | timestamp_local() }}", "startChargePercentage": 0, "targetChargePercentage": 100 }'
#  payload: '{ "portId": 510, "userCarId": 423, "departureTime": "{% if (now() > today_at("06:30")) %} {{ int(as_timestamp((now() + timedelta(days=1)).date()) + 6*60*60+1800) | timestamp_local() }} {% else %} {{ as_timestamp(today_at("06:30")) | timestamp_local() }}{% endif %}", "startChargePercentage": {{ states("sensor.zoe_battery_level") | int(0) - 10 }}, "targetChargePercentage": 100 }'

cn_remove_yxx_from_queue:
  url: "https://dev-app-cn.azurewebsites.net/chargingbox/site/37/car/423/stop"
  method: put
  headers: 
    authorization: !secret cn_rest_authorization
